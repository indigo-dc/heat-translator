tosca_definitions_version: tosca_simple_yaml_1_0

description: TOSCA template to test get_operation_output by exchanging ssh public key

topology_template:

  node_templates:
    slave:
      type: tosca.nodes.Compute
      capabilities:
        host:
         properties:
           num_cpus: 1
           mem_size: 1 GB
        os:
          properties:
            type: Linux
            distribution: Ubuntu
            version: 12.04
            architecture: x86_64
        scalable:
          properties:
            min_instances: 1
            max_instances: 5
            default_instances: 2

    master:
      type: tosca.nodes.Compute
      capabilities:
        host:
         properties:
           num_cpus: 1
           mem_size: 1 GB
        os:
          properties:
            type: Linux
            distribution: Ubuntu
            version: 12.04
            architecture: x86_64

    generate_ssh_keys_master:
      type: tosca.nodes.SoftwareComponent
      interfaces:
        Standard:
          create: artifacts/ssh/ssh_generate_keys.sh
      requirements:
        - host: master

    generate_ssh_keys_slave:
      type: tosca.nodes.SoftwareComponent
      interfaces:
        Standard:
          create: artifacts/ssh/ssh_generate_keys.sh
      requirements:
        - host: slave

    import_master_public_key:
      type: tosca.nodes.SoftwareComponent
      interfaces:
        Standard:
          create:
            implementation: artifacts/ssh/ssh_import_public_key.sh
            inputs:
              public_key: { get_operation_output: [generate_ssh_keys_master, Standard, create, public_key] }
      requirements:
        - host: slave
        - dependency: generate_ssh_keys_master

    import_slave_public_key:
      type: tosca.nodes.SoftwareComponent
      interfaces:
        Standard:
          create:
            implementation: artifacts/ssh/ssh_import_public_key.sh
            inputs:
              public_key: { get_operation_output: [generate_ssh_keys_slave, Standard, create, public_key] }
      requirements:
        - host: master
        - dependency: generate_ssh_keys_slave
